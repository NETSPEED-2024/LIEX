<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Generador para Whatsapp</title>
  <!-- Script de Google AdSense -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4652731575515103" crossorigin="anonymous"></script>
  <style>
    :root{
      --primary:#2c3e50; --secondary:#3498db; --accent:#e74c3c;
      --light:#ecf0f1; --dark:#2c3e50; --success:#2ecc71;
      --warning:#f39c12; --danger:#e74c3c;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background:linear-gradient(135deg,#f5f7fa 0%,#c3cfe2 100%);
      color:#333; line-height:1.6; padding:20px; min-height:100vh;
    }
    .container{
      max-width:1200px;margin:0 auto;background:white;border-radius:10px;
      box-shadow:0 10px 30px rgba(0,0,0,.1);overflow:hidden;
    }
    header{background:var(--primary);color:white;padding:20px;text-align:center}
    h1{font-size:2.2rem;margin-bottom:10px}
    .subtitle{font-size:1rem;opacity:.8}
    .content{display:flex;flex-wrap:wrap;padding:20px}
    .input-section,.output-section{flex:1;min-width:300px;padding:20px}
    .input-section{border-right:1px solid #eee}
    h2{color:var(--primary);margin-bottom:20px;padding-bottom:10px;border-bottom:2px solid var(--secondary)}
    .form-group{margin-bottom:20px}
    label{display:block;margin-bottom:8px;font-weight:600;color:var(--dark)}
    select,input,textarea{width:100%;padding:12px;border:1px solid #ddd;border-radius:5px;font-size:16px;transition:border .3s}
    select:focus,input:focus,textarea:focus{outline:none;border-color:var(--secondary);box-shadow:0 0 0 2px rgba(52,152,219,.2)}
    textarea{min-height:150px;resize:vertical}
    .btn{display:inline-block;padding:12px 24px;background:var(--secondary);color:white;border:none;border-radius:5px;cursor:pointer;font-size:16px;font-weight:600;transition:all .3s;margin-right:10px;margin-bottom:10px}
    .btn:hover{background:#2980b9;transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,0,0,.1)}
    .btn-success{background:var(--success)}
    .btn-success:hover{background:#27ae60}
    .btn-danger{background:var(--danger)}
    .btn-danger:hover{background:#c0392b}
    .output-area{background:#f8f9fa;border-radius:5px;padding:15px;min-height:300px;border:1px solid #ddd;white-space:pre-wrap;font-family:monospace;font-size:14px;line-height:1.5}
    .instructions{background:#e8f4fc;border-left:4px solid var(--secondary);padding:15px;margin:20px 0;border-radius:0 5px 5px 0}
    .instructions h3{color:var(--secondary);margin-bottom:10px}
    .instructions ul{padding-left:20px}
    .instructions li{margin-bottom:8px}
    .sheet-info{display:flex;flex-wrap:wrap;gap:10px;margin:15px 0}
    .sheet-pill{padding:8px 15px;background:#e8f4fc;border-radius:20px;font-size:14px;font-weight:500;color:var(--secondary);cursor:pointer;transition:all .3s}
    .sheet-pill:hover{background:var(--secondary);color:white}
    .sheet-pill.active{background:var(--secondary);color:white}
    footer{text-align:center;padding:20px;background:var(--light);color:var(--dark);font-size:14px}
    @media(max-width:768px){.content{flex-direction:column}.input-section{border-right:none;border-bottom:1px solid #eee}}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Sistema de Registro de Muestras de Laboratorio</h1>
      <p class="subtitle">Procesamiento de datos para muestras de agua, salmuera y carbonato de litio</p>
    </header>
    <div class="content">
      <div class="input-section">
        <h2>üì• Entrada de Datos</h2>
        <div class="form-group">
          <label for="sheetType">Seleccionar Tipo de Muestra:</label>
          <select id="sheetType">
            <option value="203">üìå 203 - Muestras de Agua</option>
            <option value="302">üìå 302 - Salmuera / Agua Concentrada</option>
            <option value="402-403">üìå 402-403 - Calidad de Agua</option>
            <option value="brine">üìå BRINE - Salmueras</option>
            <option value="li2co3">üìå Li‚ÇÇCO‚ÇÉ - Carbonato de Litio</option>
            <option value="reporte_id">üìå Reporte I+D</option>
          </select>
        </div>
        <div class="form-group">
          <label for="excelData">Pegar datos de Excel (separados por tabulaciones):</label>
          <textarea id="excelData" placeholder="Pega aqu√≠ los datos copiados de Excel..."></textarea>
        </div>
        <div class="sheet-info">
          <div class="sheet-pill active" data-sheet="203">203</div>
          <div class="sheet-pill" data-sheet="302">302</div>
          <div class="sheet-pill" data-sheet="402-403">402-403</div>
          <div class="sheet-pill" data-sheet="brine">BRINE</div>
          <div class="sheet-pill" data-sheet="li2co3">Li‚ÇÇCO‚ÇÉ</div>
          <div class="sheet-pill" data-sheet="reporte_id">Reporte I+D</div>
        </div>
        <button class="btn btn-primary" onclick="procesarExcel()">Procesar</button>
        <button class="btn btn-danger" onclick="eliminarDatos()">Eliminar</button>
        <button class="btn" onclick="pegarDatos()">üñåÔ∏è Pegar desde Portapapeles</button>
        <div class="instructions">
          <h3>Instrucciones:</h3>
          <ul>
            <li>Selecciona la hoja correcta (203, 302, 402-403, brine, Li2CO3 o Reporte I+D)</li>
            <li>Copia una o varias filas desde Excel (cada fila = una muestra)</li>
            <li>Pega en el campo o usa "Pegar desde Portapapeles"</li>
            <li>Haz clic en "Procesar" para obtener la salida formateada</li>
          </ul>
        </div>
      </div>
      <div class="output-section">
        <h2>üì§ Resultado Formateado</h2>
        <div id="salida" class="output-area">El resultado aparecer√° aqu√≠...</div>
        <button class="btn btn-success" onclick="copiarTexto()">üìã Copiar Texto</button>

        <!-- Bloque de anuncio responsivo -->
        <ins class="adsbygoogle"
             style="display:block;margin-top:20px"
             data-ad-client="ca-pub-4652731575515103"
             data-ad-slot="1234567890"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
        <script>
             (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      </div>
    </div>
    <footer>
      <p>Sistema de Registro de Muestras de Laboratorio ¬© 2025 | Dise√±ado para procesar datos de Excel | William Campal</p>
    </footer>
  </div>
  <script>
    /* --------------------------
       CONFIGURACIONES (mapas)
       Cada array asume:
       col 0 = Identificaci√≥n
       col 1 = C√≥digo (laboratorio)
       col 2... = par√°metros seg√∫n el orden del encabezado
       ---------------------------*/
    const configuraciones = {
      "203": [
        {nombre:"B", i:2, u:"mg/L"}, {nombre:"Ca", i:3, u:"mg/L"}, {nombre:"K", i:4, u:"mg/L"},
        {nombre:"Li", i:5, u:"mg/L"}, {nombre:"Mg", i:6, u:"mg/L"}, {nombre:"Na", i:7, u:"mg/L"},
        {nombre:"Humedad", i:8, u:"%"}, {nombre:"Fe", i:9, u:"mg/L"}, {nombre:"SO4", i:10, u:"mg/L"},
        {nombre:"CO3", i:11, u:"mg/L"}, {nombre:"HCO3", i:12, u:"mg/L"}, {nombre:"OH", i:13, u:"mg/L"},
        {nombre:"pH", i:14, u:""}, {nombre:"Densidad", i:15, u:"g/ml"}, {nombre:"Conductividad", i:16, u:"¬µS/cm"},
        {nombre:"Dureza Total", i:17, u:"mg/L"}, {nombre:"Turbidez", i:18, u:"NTU"}, {nombre:"Si", i:19, u:"mg/L"},
        {nombre:"OD", i:20, u:"%"}
      ],
      "302": [
        {nombre:"B", i:2, u:"mg/L"}, {nombre:"Ca", i:3, u:"mg/L"}, {nombre:"K", i:4, u:"mg/L"},
        {nombre:"Li", i:5, u:"mg/L"}, {nombre:"Mg", i:6, u:"mg/L"}, {nombre:"Na", i:7, u:"mg/L"},
        {nombre:"Densidad", i:8, u:"g/ml"}, {nombre:"pH", i:9, u:""}, {nombre:"CO3", i:10, u:"mg/L"},
        {nombre:"HCO3", i:11, u:"mg/L"}, {nombre:"OH", i:12, u:"mg/L"}, {nombre:"Fe", i:13, u:"mg/L"},
        {nombre:"Temperatura", i:14, u:"¬∞C"}, {nombre:"% S√≥lidos", i:15, u:"%"}, {nombre:"Conductividad", i:16, u:"¬µS/cm"},
        {nombre:"TDS", i:17, u:"mg/L"}, {nombre:"Cloruros", i:18, u:"%"}, {nombre:"Dureza Total", i:19, u:"mg/L"},
        {nombre:"Alcalinidad", i:20, u:"mg/L"}, {nombre:"Turbidez", i:21, u:"NTU"}, {nombre:"Cloro libre", i:22, u:"mg/L"},
        {nombre:"OD", i:23, u:"%"}
      ],
      "402-403": [
        {nombre:"pH", i:2, u:""}, {nombre:"Conductividad", i:3, u:"¬µS/cm"},
        {nombre:"Dureza Total", i:4, u:"mg/L"}, {nombre:"Alcalinidad", i:5, u:"mg/L"},
        {nombre:"Turbidez", i:6, u:"NTU"}, {nombre:"Cloro libre", i:7, u:"mg/L"},
        {nombre:"OD", i:8, u:"%"}, {nombre:"Fe", i:9, u:"mg/L"}, {nombre:"Temperatura", i:10, u:"¬∞C"},
        {nombre:"K", i:11, u:"mg/L"}, {nombre:"Li", i:12, u:"mg/L"}, {nombre:"Mg", i:13, u:"mg/L"},
        {nombre:"Mn", i:14, u:"mg/L"}, {nombre:"Na", i:15, u:"mg/L"}, {nombre:"SO4", i:16, u:"mg/L"},
        {nombre:"Densidad", i:17, u:"g/ml"}
      ],
      "brine": [
        {nombre:"B", i:2, u:"mg/L"}, {nombre:"Ca", i:3, u:"mg/L"}, {nombre:"K", i:4, u:"mg/L"},
        {nombre:"Li", i:5, u:"mg/L"}, {nombre:"Mg", i:6, u:"mg/L"}, {nombre:"Na", i:7, u:"mg/L"},
        {nombre:"Densidad", i:8, u:"g/ml"}, {nombre:"pH", i:9, u:""}
      ],
      "li2co3": [
        {nombre:"B", i:2, u:"mg/kg"}, {nombre:"Ca", i:3, u:"mg/kg"}, {nombre:"K", i:4, u:"mg/kg"},
        {nombre:"Li", i:5, u:"mg/kg"}, {nombre:"Mg", i:6, u:"mg/kg"}, {nombre:"Na", i:7, u:"mg/kg"},
        {nombre:"Humedad", i:8, u:"%"}, {nombre:"CO3¬≤‚Åª", i:9, u:"mg/kg"}, {nombre:"Pureza", i:10, u:"%"},
        {nombre:"Fe", i:13, u:"mg/kg"}, {nombre:"SO4", i:14, u:"mg/kg"}, {nombre:"Al", i:15, u:"mg/kg"}
      ],
      "reporte_id": [
        {nombre:"Fecha de muestreo", i:0, u:""},
        {nombre:"Fecha de ingreso", i:1, u:""},
        {nombre:"Fecha de an√°lisis", i:2, u:""},
        {nombre:"Identificaci√≥n", i:3, u:""},
        {nombre:"C√≥digo", i:4, u:""},
        {nombre:"As", i:5, u:"ppm"},
        {nombre:"Li", i:6, u:"ppm"},
        {nombre:"Na", i:7, u:"ppm"},
        {nombre:"K", i:8, u:"ppm"},
        {nombre:"Al", i:9, u:"ppm"},
        {nombre:"B", i:10, u:"ppm"},
        {nombre:"Ba", i:11, u:"ppm"},
        {nombre:"Ca", i:12, u:"ppm"},
        {nombre:"Cd", i:13, u:"ppm"},
        {nombre:"Cr", i:14, u:"ppm"},
        {nombre:"Cu", i:15, u:"ppm"},
        {nombre:"Fe", i:16, u:"ppm"},
        {nombre:"Mg", i:17, u:"ppm"},
        {nombre:"Mn", i:18, u:"ppm"},
        {nombre:"Ni", i:19, u:"ppm"},
        {nombre:"S", i:20, u:"ppm"},
        {nombre:"Sr", i:21, u:"ppm"},
        {nombre:"Si", i:22, u:"ppm"},
        {nombre:"Ti", i:23, u:"ppm"},
        {nombre:"Zn", i:24, u:"ppm"},
        {nombre:"Pb", i:25, u:"ppm"},
        {nombre:"PO4", i:26, u:"ppm"},
        {nombre:"SO4", i:27, u:"ppm"},
        {nombre:"Densidad", i:28, u:"g/ml"},
        {nombre:"pH", i:29, u:""},
        {nombre:"Temperatura", i:30, u:"¬∞C"},
        {nombre:"Humedad", i:31, u:"%"},
        {nombre:"% S√≥lidos", i:32, u:"%"},
        {nombre:"Conductividad", i:33, u:"¬µS/cm"},
        {nombre:"STD", i:34, u:"ppm"},
        {nombre:"Ca (volum√©trico)", i:35, u:"ppm"},
        {nombre:"Cloruros", i:36, u:"ppm"},
        {nombre:"Dureza Total", i:37, u:"ppm"},
        {nombre:"Alcalinidad", i:38, u:"ppm"},
        {nombre:"CO3", i:39, u:"ppm"},
        {nombre:"HCO3", i:40, u:"ppm"},
        {nombre:"OH", i:41, u:"ppm"},
        {nombre:"Pureza (% Li‚ÇÇCO‚ÇÉ)", i:42, u:"%"},
        {nombre:"% Humedad", i:43, u:"%"}
      ]
    };
    /* --------------------------
       CODIGOS: definici√≥n clara
       S√ìLIDOS: CL, CM, MP, OS -> mg/kg (donde aplique)
       L√çQUIDOS: SM, AC, OL, AG -> mg/L (donde aplique)
       ---------------------------*/
    const codigosSolidos = ["CL","CM","MP","OS"];
    const codigosLiquidos = ["SM","AC","OL","AG"];
    /* --------------------------
       Interactividad UI
       ---------------------------*/
    document.querySelectorAll('.sheet-pill').forEach(pill=>{
      pill.addEventListener('click', function(){
        document.querySelectorAll('.sheet-pill').forEach(p=>p.classList.remove('active'));
        this.classList.add('active');
        document.getElementById('sheetType').value = this.getAttribute('data-sheet');
      });
    });
    async function pegarDatos(){
      try{
        const text = await navigator.clipboard.readText();
        document.getElementById('excelData').value = text;
      }catch(err){
        alert('No se pudo acceder al portapapeles. Por favor, pega manualmente los datos.');
      }
    }
    /* --------------------------
       Detectar estado (s√≥lido/liÃÅquido)
       - PRIMERO: mirar el C√ìDIGO (columna 1)
       - SEGUNDO: fallback mirar IDENTIFICACI√ìN (columna 0)
       - TERCERO: si nada, default 'liquido'
       ---------------------------*/
    function detectarEstado(identificacion, codigo){
      const idUp = (identificacion||"").toString().toUpperCase();
      const codUp = (codigo||"").toString().toUpperCase();
      // 1) por codigo (columna 1) -> prioridad
      for(const c of codigosSolidos){
        if(codUp.includes(c)) return "solido";
      }
      for(const c of codigosLiquidos){
        if(codUp.includes(c)) return "liquido";
      }
      // 2) fallback por identificacion (columna 0)
      for(const c of codigosSolidos){
        if(idUp.includes(c)) return "solido";
      }
      for(const c of codigosLiquidos){
        if(idUp.includes(c)) return "liquido";
      }
      // 3) otros heur√≠sticos (identifica terminaciones '-S' como solido)
      if(idUp.endsWith("-S")) return "solido";
      if(idUp.includes("-S")) return "solido";
      if(idUp.includes(" OS")) return "solido";
      // default
      return "liquido";
    }
    /* --------------------------
       Procesar entrada y generar salida
       ---------------------------*/
    function procesarExcel(){
      const sheetType = document.getElementById("sheetType").value;
      const textoPegado = document.getElementById("excelData").value.trim();
      if(!textoPegado){ alert("Pega datos desde Excel"); return; }
      // separar filas y columnas (tabulador)
      const filas = textoPegado.split("\n").map(r=>r.split("\t"));
      let salida = "";
      filas.forEach(raw=>{
        // limpiar campos (trim cada celda)
        const datos = raw.map(d => d ? d.toString().trim() : "");
        // si fila vac√≠a -> saltar
        const hasData = datos.some(d => d !== "" && d !== "-" && d !== "N/D");
        if(!hasData) return;
        // distintos formatos: reporte_id es un caso especial (fechas al inicio)
        if(sheetType === "reporte_id"){
          const fechaMuestreo = datos[0] || "";
          const fechaIngreso = datos[1] || "";
          const fechaAnalisis = datos[2] || "";
          const identificacion = datos[3] || "";
          const codigo = datos[4] || "";
          const estado = detectarEstado(identificacion, codigo);
          salida += `\nüìÖ Fecha de muestreo: ${fechaMuestreo}\n`;
          salida += `üì• Fecha de ingreso: ${fechaIngreso}\n`;
          salida += `üî¨ Fecha de an√°lisis: ${fechaAnalisis}\n`;
          salida += `üîπ Identificaci√≥n: ${identificacion}\n`;
          salida += `üîπ C√≥digo: ${codigo}\n`;
          const config = configuraciones[sheetType] || [];
          config.forEach(a=>{
            // omitimos los 5 primeros que ya mostramos (0..4)
            if(a.i <= 4) return;
            if(a.i < datos.length){
              const valorRaw = datos[a.i];
              if(valorRaw && valorRaw !== "N/D" && valorRaw !== "-"){
                let unidad = a.u || "";
                if(unidad === "mg/L" && estado === "solido") unidad = "mg/kg";
                salida += `‚Ä¢ ${a.nombre}: ${valorRaw} ${unidad}\n`;
              }
            }
          });
        } else {
          // formato normal (identificacion en col 0, codigo en col 1)
          const identificacion = datos[0] || "";
          const codigo = datos[1] || "";
          const estado = detectarEstado(identificacion, codigo);
          salida += `\nüîπ Identificaci√≥n: ${identificacion}\nüîπ C√≥digo: ${codigo}\n`;
          const config = configuraciones[sheetType] || [];
          config.forEach(a=>{
            const valor = (a.i < datos.length) ? datos[a.i] : "";
            if(!valor || valor === "N/D" || valor === "-") return;
            let unidad = a.u || "";
            // si la unidad original es mg/L y hemos detectado s√≥lido -> mostrar mg/kg
            if(unidad === "mg/L" && estado === "solido") unidad = "mg/kg";
            salida += `‚Ä¢ ${a.nombre}: ${valor} ${unidad}\n`;
          });
        }
        salida += "-------------------------\n";
      });
      document.getElementById("salida").textContent = salida.trim();
    }
    function eliminarDatos(){
      document.getElementById('excelData').value = '';
      document.getElementById('salida').textContent = 'El resultado aparecer√° aqu√≠...';
      document.querySelectorAll('.sheet-pill').forEach(p=>p.classList.remove('active'));
      document.getElementById('sheetType').value = '203';
      document.querySelector('.sheet-pill[data-sheet="203"]').classList.add('active');
    }
    function copiarTexto(){
      const texto = document.getElementById('salida').textContent;
      if(!texto || texto === 'El resultado aparecer√° aqu√≠...'){
        alert('No hay datos para copiar'); return;
      }
      navigator.clipboard.writeText(texto).then(()=>{ alert('Texto copiado al portapapeles ‚úÖ'); })
      .catch(err=>{ alert('Error al copiar el texto: ' + err); });
    }
  </script>
<!-- Code injected by live-server -->
<script>
	// <![CDATA[  <-- For SVG support
	if ('WebSocket' in window) {
		(function () {
			function refreshCSS() {
				var sheets = [].slice.call(document.getElementsByTagName("link"));
				var head = document.getElementsByTagName("head")[0];
				for (var i = 0; i < sheets.length; ++i) {
					var elem = sheets[i];
					var parent = elem.parentElement || head;
					parent.removeChild(elem);
					var rel = elem.rel;
					if (elem.href && typeof rel != "string" || rel.length == 0 || rel.toLowerCase() == "stylesheet") {
						var url = elem.href.replace(/(&|\?)_cacheOverride=\d+/, '');
						elem.href = url + (url.indexOf('?') >= 0 ? '&' : '?') + '_cacheOverride=' + (new Date().valueOf());
					}
					parent.appendChild(elem);
				}
			}
			var protocol = window.location.protocol === 'http:' ? 'ws://' : 'wss://';
			var address = protocol + window.location.host + window.location.pathname + '/ws';
			var socket = new WebSocket(address);
			socket.onmessage = function (msg) {
				if (msg.data == 'reload') window.location.reload();
				else if (msg.data == 'refreshcss') refreshCSS();
			};
			if (sessionStorage && !sessionStorage.getItem('IsThisFirstTime_Log_From_LiveServer')) {
				console.log('Live reload enabled.');
				sessionStorage.setItem('IsThisFirstTime_Log_From_LiveServer', true);
			}
		})();
	}
	else {
		console.error('Upgrade your browser. This Browser is NOT supported WebSocket for Live-Reloading.');
	}
	// ]]>
</script>
</body>
</html>
